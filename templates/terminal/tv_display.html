{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Terminal TV Display | RDFS</title>

  <link rel="icon" type="image/png" href="{% static 'img/RDFS-Logo.png' %}">
  <link rel="stylesheet" href="{% static 'styles/terminal/01.css' %}">
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'styles/terminal/tv_display.css' %}">
</head>

<body>

<header class="tv-mini-header">
  <div class="tv-mini-header__left">
    <a href="{% url 'accounts:staff_dashboard' %}" class="tv-mini-btn tv-mini-btn--dashboard">
      <i class="fa-solid fa-circle-arrow-left"></i>
      <span>Back to dashboard</span>
    </a>
    <div class="tv-mini-route-chip">
      <i class="fa-solid fa-location-dot"></i>
      <span>
        {% if selected_route %}
          {{ selected_route }}
        {% else %}
          All routes
        {% endif %}
      </span>
    </div>
  </div>
  <div class="tv-mini-header__right">
    <div id="live-clock" class="tv-mini-clock">
      <i class="fa-solid fa-clock-rotate-left"></i>
      <span id="current-date"></span>
      <span class="tv-mini-clock__divider">·</span>
      <span id="current-time"></span>
    </div>
    <button id="fullscreenBtn" class="tv-mini-btn tv-mini-btn--fullscreen">
      <i class="fa-solid fa-expand"></i>
      <span>Fullscreen</span>
    </button>
  </div>
</header>

<main class="tv-grid-wrapper">
  <section class="route-grid">
    {% if route_sections %}
      {% for section in route_sections %}
      <article class="route-card" data-route="{{ section.slug }}">
        <header class="route-card__header">
          <div>
            <h3 class="route-card__title">{{ section.name }}</h3>
            <p class="route-card__subtitle">
              {{ section.entries|length }} Vehicles
              <span class="route-card__subtitle-muted">
                · Queued {{ section.status_summary.Queued|default:0 }}
              </span>
            </p>
          </div>
        </header>
        <div class="route-card__entries">
          {% if section.entries %}
            {% for entry in section.entries %}
            <div class="route-entry">
              <div class="route-entry__top">
                <span class="route-entry__plate">{{ entry.vehicle_plate|default:"—" }}</span>
                <span class="status-pill status-pill-{{ entry.status|lower }}">
                  {{ entry.status }}
                </span>
              </div>
              <div class="route-entry__info">
                <span class="route-entry__driver">
                  <i class="fa-solid fa-user-tie"></i> {{ entry.driver_name }}
                </span>
                <span class="route-entry__times">
                  <i class="fa-solid fa-calendar-days"></i>
                  {{ entry.entry_time_display }} → {{ entry.departure_time_display }}
                </span>
              </div>
              <div class="route-entry__countdown">
                {% if entry.countdown_active %}
                  <span class="countdown-element" data-expiry="{{ entry.expiry_timestamp }}">
                    <span class="countdown-text">--:--</span>
                  </span>
                {% else %}
                  <span class="departed-pill">Departed</span>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          {% else %}
          <div class="route-card__empty">
            <i class="fa-solid fa-circle-dot"></i>
            <span>Awaiting vehicles</span>
                  </div>
                  {% endif %}
        </div>
        {% if section.history_events %}
        <div class="route-card__history">
          <div class="history-title">Recent activity</div>
          <ul>
            {% for event in section.history_events %}
            <li>
              <span class="history-plate">{{ event.vehicle_plate }}</span>
              <span class="history-action">{{ event.action }}</span>
              <span class="history-time">{{ event.timestamp }}</span>
            </li>
              {% endfor %}
          </ul>
        </div>
        {% endif %}
      </article>
      {% endfor %}
    {% else %}
    <div class="route-empty-state">
      <i class="fa-solid fa-circle-exclamation"></i>
      <p>No routes active right now.</p>
      </div>
    {% endif %}
  </section>
</main>

<script src="{% static 'js/terminal/tv_display.js' %}" defer></script>

</body>
</html>