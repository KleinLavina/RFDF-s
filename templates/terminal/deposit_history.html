{% extends "base.html" %}
{% load static %}

{% block title %}Deposit History | RDFS{% endblock %}

{% block content %}

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="{% static 'styles/deposit_menu.css' %}" />

<div class="p-4 rdfs-deposit-scope">
  <div class="rdfs-deposit-container">

    <div class="wallets-header">
      <div>
        <h3 class="wallets-title mb-1">
          <i class="fa-solid fa-clock me-2"></i>
          Deposit History
        </h3>
        <p class="wallets-note mb-0">
          Showing {{ total_count }} records · Total ₱{{ total_amount|floatformat:2 }}
        </p>
      </div>
      <div class="wallets-actions">
        <a href="{% url 'terminal:deposit_menu' %}" class="btn btn-outline-primary">
          <i class="fa-solid fa-wallet me-1"></i>
          Back to Wallets
        </a>
      </div>
    </div>

    <section class="wallets-toolbar mb-4">
      <div class="card-body d-flex flex-wrap gap-3 align-items-end">
        <form method="get" class="row g-3 align-items-end w-100">
          <div class="col-md-5">
            <label class="form-label fw-semibold">Search deposits</label>
            <input type="text"
                   name="history_query"
                   value="{{ history_query }}"
                   class="form-control"
                   placeholder="Driver name, plate, or license">
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Sort by</label>
            <select name="history_sort" class="form-select">
              <option value="newest" {% if history_sort == 'newest' %}selected{% endif %}>
                Newest entries
              </option>
              <option value="largest" {% if history_sort == 'largest' %}selected{% endif %}>
                Largest deposits
              </option>
              <option value="smallest" {% if history_sort == 'smallest' %}selected{% endif %}>
                Smallest deposits
              </option>
              <option value="driver_asc" {% if history_sort == 'driver_asc' %}selected{% endif %}>
                Driver A → Z
              </option>
              <option value="driver_desc" {% if history_sort == 'driver_desc' %}selected{% endif %}>
                Driver Z → A
              </option>
            </select>
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-outline-primary w-100">
              <i class="fa-solid fa-arrow-right-arrow-left me-1"></i>
              Apply
            </button>
          </div>
        </form>
      </div>
    </section>

    <section class="recent-history card border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover mb-0">
            <thead class="table-light text-muted small text-uppercase">
              <tr>
                <th>#</th>
                <th>Reference</th>
                <th>Driver</th>
                <th>Vehicle</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {% for deposit in history_deposits %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td><strong>{{ deposit.reference_number }}</strong></td>
                  <td>
                    {{ deposit.wallet.vehicle.assigned_driver.first_name }}
                    {{ deposit.wallet.vehicle.assigned_driver.last_name }}
                  </td>
                  <td>{{ deposit.wallet.vehicle.license_plate }}</td>
                  <td>₱{{ deposit.amount|floatformat:2 }}</td>
                  <td>{{ deposit.status|capfirst }}</td>
                  <td>{{ deposit.created_at|date:"M d, Y h:i A" }}</td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="7" class="text-center text-muted">
                    No deposits found.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>

  </div>
</div>

{% endblock %}
