{% extends "base.html" %}
{% load static %}
{% block title %}Admin Dashboard | RDFS{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'styles/accounts/admin-dashboard.css' %}?v=1.0">
{% endblock %}

{% block content %}
<div class="admin-dashboard">
  <div class="container">
    
    <!-- HEADER -->
    <div class="admin-dashboard__header">
      <h1 class="admin-dashboard__title">
        <i class="bi bi-speedometer2"></i>
        Admin Dashboard
      </h1>
      <p class="admin-dashboard__subtitle">
        Welcome back, <strong>{{ user.username }}</strong>. Here is your system overview.
      </p>
    </div>

    <!-- STAT CARDS ROW 1 -->
    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <a href="{% url 'vehicles:registered_drivers' %}" class="text-decoration-none">
          <div class="stat-card stat-card--primary">
            <div class="stat-card__icon">
              <i class="bi bi-people-fill"></i>
            </div>
            <div class="stat-card__label">Registered Drivers</div>
            <div class="stat-card__value">{{ total_drivers }}</div>
            <div class="stat-card__meta">Total active drivers · Click to view</div>
          </div>
        </a>
      </div>

      <div class="col-md-4">
        <a href="{% url 'vehicles:registered_vehicles' %}" class="text-decoration-none">
          <div class="stat-card stat-card--success">
            <div class="stat-card__icon">
              <i class="bi bi-truck-front-fill"></i>
            </div>
            <div class="stat-card__label">Registered Vehicles</div>
            <div class="stat-card__value">{{ total_vehicles }}</div>
            <div class="stat-card__meta">Total fleet size · Click to view</div>
          </div>
        </a>
      </div>

      <div class="col-md-4">
        <a href="{% url 'terminal:transactions' %}" class="text-decoration-none">
          <div class="stat-card stat-card--warning">
            <div class="stat-card__icon">
              <i class="bi bi-list-ol"></i>
            </div>
            <div class="stat-card__label">Active Queue</div>
            <div class="stat-card__value">{{ total_queue }}</div>
            <div class="stat-card__meta">Vehicles in terminal · Click to view</div>
          </div>
        </a>
      </div>
    </div>

    <!-- REVENUE CARDS ROW 2 -->
    <div class="row g-4 mb-4">
      <div class="col-md-6">
        <a href="{% url 'reports:reports_home' %}" class="text-decoration-none">
          <div class="revenue-card">
            <div class="revenue-card__icon">
              <i class="bi bi-calendar-month"></i>
            </div>
            <div class="revenue-card__label">Monthly Revenue</div>
            <div class="revenue-card__value">₱{{ monthly_revenue|floatformat:2 }}</div>
            <div class="revenue-card__period">{{ now|date:"F Y" }} · Click for reports</div>
          </div>
        </a>
      </div>

      <div class="col-md-6">
        <a href="{% url 'reports:reports_home' %}" class="text-decoration-none">
          <div class="revenue-card">
            <div class="revenue-card__icon">
              <i class="bi bi-calendar-range"></i>
            </div>
            <div class="revenue-card__label">Annual Revenue</div>
            <div class="revenue-card__value">₱{{ annual_revenue|floatformat:2 }}</div>
            <div class="revenue-card__period">{{ now|date:"Y" }} · Click for reports</div>
          </div>
        </a>
      </div>
    </div>

    <!-- PROFIT CHART -->
    <div class="row g-4 mb-4">
      <div class="col-12">
        <div class="chart-card">
          <h3 class="chart-card__title">
            <i class="bi bi-graph-up"></i>
            7-Day Profit Trend
          </h3>
          <canvas id="profitChart" height="80"></canvas>
        </div>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="mb-4">
      <h3 class="section-header__title mb-3">
        <i class="bi bi-lightning-charge-fill"></i>
        Quick Actions
      </h3>
      <div class="row g-4">
        <div class="col-md-4">
          <a href="{% url 'reports:reports_home' %}" class="text-decoration-none">
            <div class="action-card">
              <div class="action-card__icon">
                <i class="bi bi-bar-chart-fill"></i>
              </div>
              <h4 class="action-card__title">Reports & Analytics</h4>
              <p class="action-card__description">
                View detailed system metrics, revenue reports, and performance insights.
              </p>
              <button class="action-card__button">
                View Reports
              </button>
            </div>
          </a>
        </div>

        <div class="col-md-4">
          <a href="{% url 'terminal:system_and_routes' %}" class="text-decoration-none">
            <div class="action-card">
              <div class="action-card__icon">
                <i class="bi bi-gear-fill"></i>
              </div>
              <h4 class="action-card__title">System & Routes</h4>
              <p class="action-card__description">
                Configure system settings, manage routes, and adjust terminal parameters.
              </p>
              <button class="action-card__button">
                Configure
              </button>
            </div>
          </a>
        </div>

        <div class="col-md-4">
          <a href="{% url 'accounts:manage_users' %}" class="text-decoration-none">
            <div class="action-card">
              <div class="action-card__icon">
                <i class="bi bi-person-gear"></i>
              </div>
              <h4 class="action-card__title">Manage Users</h4>
              <p class="action-card__description">
                Create, edit, and manage admin and staff user accounts.
              </p>
              <button class="action-card__button">
                Manage Users
              </button>
            </div>
          </a>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="dashboard-footer">
      <p>Last updated: {{ now|date:"F d, Y · g:i A" }}</p>
    </div>

  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('profitChart');
  if (ctx) {
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: {{ chart_labels|safe }},
        datasets: [{
          label: 'Daily Profit (₱)',
          data: {{ chart_data|safe }},
          borderColor: '#2563eb',
          backgroundColor: 'rgba(37, 99, 235, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 5,
          pointHoverRadius: 7,
          pointBackgroundColor: '#2563eb',
          pointBorderColor: '#fff',
          pointBorderWidth: 2,
          pointHoverBackgroundColor: '#1d4ed8',
          pointHoverBorderColor: '#fff',
          pointHoverBorderWidth: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(17, 38, 102, 0.95)',
            titleColor: '#fff',
            bodyColor: '#fff',
            padding: 12,
            borderColor: '#2563eb',
            borderWidth: 1,
            displayColors: false,
            callbacks: {
              label: function(context) {
                return '₱' + context.parsed.y.toLocaleString('en-US', {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2
                });
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '₱' + value.toLocaleString();
              },
              color: '#6b7280',
              font: {
                size: 12
              }
            },
            grid: {
              color: '#e5e7eb',
              drawBorder: false
            }
          },
          x: {
            ticks: {
              color: '#6b7280',
              font: {
                size: 12
              }
            },
            grid: {
              display: false
            }
          }
        }
      }
    });
  }
});
</script>
{% endblock %}
